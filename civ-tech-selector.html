<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Civilization I – Tech Prerequisite Explorer</title>
    <style>
      :root {
        --bg: #0f172a;
        --panel: #111827;
        --muted: #94a3b8;
        --text: #e5e7eb;
        --accent: #38bdf8;
        --unit-color: #fbbf24;
        --building-color: #34d399;
        --wonder-color: #a78bfa;
        --other-color: #f87171;
      }
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, Helvetica, sans-serif;
        background: var(--bg);
        color: var(--text);
      }
      .wrap {
        max-width: 900px;
        margin: 40px auto;
        padding: 24px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.02));
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }
      h1 {
        margin: 0 0 12px;
        font-size: 24px;
        letter-spacing: 0.3px;
      }
      p {
        margin: 0 0 16px;
        color: var(--muted);
      }
      select,
      input[type="text"] {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: #0b1220;
        color: var(--text);
      }
      .row {
        display: grid;
        gap: 14px;
        grid-template-columns: 1fr;
      }
      @media (min-width: 720px) {
        .row {
          grid-template-columns: 1fr 1fr;
        }
      }
      .panel {
        padding: 16px;
        background: #0b1220;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
      }
      .muted {
        color: var(--muted);
      }
      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .chip {
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: #0f172a;
        font-size: 13px;
      }
      .list {
        margin-top: 10px;
      }
      .list li {
        margin: 6px 0;
        padding: 8px 10px;
        border-radius: 8px;
        background: #0f172a;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .small {
        font-size: 12px;
      }
      .accent {
        color: var(--accent);
      }
      .allows-chip {
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 8px;
        font-weight: 500;
      }
      .allows-unit {
        background: #fbbf24;
        color: #000;
      }
      .allows-building {
        background: #34d399;
        color: #000;
      }
      .allows-wonder {
        background: #a78bfa;
        color: #000;
      }
      .allows-other {
        background: #f87171;
        color: #000;
      }
      .allows-list {
        margin-top: 4px;
        font-size: 11px;
        color: var(--muted);
      }
      .footer {
        margin-top: 20px;
        font-size: 12px;
        color: var(--muted);
      }
      .inline-code {
        padding: 0.1em 0.4em;
        border-radius: 6px;
        background: #0b1220;
        border: 1px solid rgba(255, 255, 255, 0.08);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Sid Meier’s Civilization I – Tech Prerequisite Explorer</h1>
      <p>Select a technology to see the prerequisite chain you need (in order). Data is encoded in a simple JS object (<span class="inline-code">{ [tech]: [req1, req2] }</span>).</p>

      <div class="row">
        <div class="panel">
          <label for="search" class="muted small">Filter technologies</label>
          <input id="search" type="text" placeholder="Type to filter… (e.g. 'Flight')" oninput="filterOptions()" />
          <div style="height: 10px"></div>
          <label for="tech" class="muted small">Choose a technology</label>
          <select id="tech" size="12" onchange="render()"></select>
        </div>

        <div class="panel">
          <div class="chips" id="summary"></div>
          <ol class="list" id="chain"></ol>
          <div id="notes" class="footer"></div>
        </div>
      </div>
    </div>

    <script>
      // --- Unified data structure: tech -> { prereqs: [], allows: {} } ---
      // Source: Civilization Wiki - https://civilization.fandom.com/wiki/List_of_advances_in_Civ1
      const advances = {
        "Advanced Flight": {
          prereqs: ["Flight", "Electricity"],
          allows: { units: ["Bomber", "Carrier"] },
        },
        Alphabet: {
          prereqs: [],
          allows: {},
        },
        Astronomy: {
          prereqs: ["Mysticism", "Mathematics"],
          allows: { wonders: ["Copernicus' Observatory"] },
        },
        "Atomic Theory": {
          prereqs: ["Theory of Gravity", "Physics"],
          allows: {},
        },
        Automobile: {
          prereqs: ["Combustion", "Steel"],
          allows: { units: ["Armor"] },
        },
        Banking: {
          prereqs: ["Trade", "The Republic"],
          allows: { buildings: ["Bank"] },
        },
        "Bridge Building": {
          prereqs: ["Iron Working", "Alphabet"],
          allows: { other: ["Road on river squares"] },
        },
        "Bronze Working": {
          prereqs: [],
          allows: { units: ["Phalanx"], wonders: ["Colossus"] },
        },
        "Ceremonial Burial": {
          prereqs: [],
          allows: {},
        },
        Chemistry: {
          prereqs: ["University", "Medicine"],
          allows: {},
        },
        Chivalry: {
          prereqs: ["Feudalism", "Horseback Riding"],
          allows: { units: ["Knights"] },
        },
        "Code of Laws": {
          prereqs: ["Alphabet"],
          allows: {},
        },
        Combustion: {
          prereqs: ["Refining", "Explosives"],
          allows: { units: ["Frigate"] },
        },
        Communism: {
          prereqs: ["Philosophy", "Industrialization"],
          allows: { other: ["Communism"] },
        },
        Computers: {
          prereqs: ["Mathematics", "Electronics"],
          allows: { wonders: ["SETI Program"] },
        },
        Conscription: {
          prereqs: ["The Republic", "Explosives"],
          allows: {},
        },
        Construction: {
          prereqs: ["Masonry", "Currency"],
          allows: { buildings: ["Aqueduct"] },
        },
        "The Corporation": {
          prereqs: ["Banking", "Industrialization"],
          allows: { buildings: ["Mfg. Plant"] },
        },
        Currency: {
          prereqs: ["Bronze Working"],
          allows: {},
        },
        Democracy: {
          prereqs: ["Philosophy", "Literacy"],
          allows: { other: ["Democracy"], buildings: ["Fortress"], wonders: ["United Nations", "Women's Suffrage"] },
        },
        Electricity: {
          prereqs: ["Magnetism", "Metallurgy"],
          allows: { units: ["Cruiser"], buildings: ["Power Plant"] },
        },
        Electronics: {
          prereqs: ["Electricity"],
          allows: { units: ["Submarine"], buildings: ["Hydro Plant"] },
        },
        Engineering: {
          prereqs: ["The Wheel", "Construction"],
          allows: {},
        },
        Explosives: {
          prereqs: ["Gunpowder", "Chemistry"],
          allows: { units: ["Cannon"] },
        },
        Feudalism: {
          prereqs: ["Masonry", "Monarchy"],
          allows: {},
        },
        Flight: {
          prereqs: ["Combustion", "Physics"],
          allows: { units: ["Fighter"] },
        },
        "Fusion Power": {
          prereqs: ["Nuclear Power", "Superconductor"],
          allows: {},
        },
        "Future Tech": {
          prereqs: ["Fusion Power"],
          allows: {},
        },
        "Genetic Engineering": {
          prereqs: ["Medicine", "The Corporation"],
          allows: {},
        },
        Gunpowder: {
          prereqs: ["Invention", "Iron Working"],
          allows: { units: ["Musketeers"] },
        },
        "Horseback Riding": {
          prereqs: [],
          allows: { units: ["Cavalry"] },
        },
        Industrialization: {
          prereqs: ["Railroad", "Banking"],
          allows: { buildings: ["Factory"], wonders: ["Hoover Dam"] },
        },
        Invention: {
          prereqs: ["Engineering", "Literacy"],
          allows: {},
        },
        "Iron Working": {
          prereqs: ["Bronze Working"],
          allows: { units: ["Legion"], wonders: ["Great Wall"] },
        },
        "Labor Union": {
          prereqs: ["Mass Production", "Communism"],
          allows: {},
        },
        Literacy: {
          prereqs: ["Writing", "Code of Laws"],
          allows: {},
        },
        Magnetism: {
          prereqs: ["Navigation", "Physics"],
          allows: {},
        },
        Mapmaking: {
          prereqs: ["Alphabet"],
          allows: { wonders: ["Lighthouse"], other: ["Sail"] },
        },
        Masonry: {
          prereqs: [],
          allows: { buildings: ["City Walls"], wonders: ["Pyramids"], other: ["Mines"] },
        },
        "Mass Production": {
          prereqs: ["Automobile", "The Corporation"],
          allows: { units: ["Artillery"], buildings: ["Mass Transit"] },
        },
        Mathematics: {
          prereqs: ["Alphabet", "Masonry"],
          allows: {},
        },
        Medicine: {
          prereqs: ["Philosophy", "Trade"],
          allows: { wonders: ["Cure for Cancer"] },
        },
        Metallurgy: {
          prereqs: ["Gunpowder", "University"],
          allows: {},
        },
        Monarchy: {
          prereqs: ["Ceremonial Burial", "Code of Laws"],
          allows: { other: ["Monarchy"], buildings: ["Temple"] },
        },
        Mysticism: {
          prereqs: ["Ceremonial Burial"],
          allows: { wonders: ["Oracle"] },
        },
        Navigation: {
          prereqs: ["Mapmaking", "Astronomy"],
          allows: { wonders: ["Magellan's Expedition"] },
        },
        "Nuclear Fission": {
          prereqs: ["Mass Production", "Atomic Theory"],
          allows: { wonders: ["Manhattan Project"] },
        },
        "Nuclear Power": {
          prereqs: ["Nuclear Fission", "Electronics"],
          allows: { units: ["Nuclear unit"] },
        },
        Philosophy: {
          prereqs: ["Mysticism", "Literacy"],
          allows: {},
        },
        Physics: {
          prereqs: ["Mathematics", "Navigation"],
          allows: {},
        },
        Plastics: {
          prereqs: ["Refining", "Space Flight"],
          allows: { units: ["Transport"] },
        },
        Pottery: {
          prereqs: [],
          allows: { buildings: ["Granary"], wonders: ["Hanging Gardens"], other: ["Irrigation"] },
        },
        Railroad: {
          prereqs: ["Steam Engine", "Bridge Building"],
          allows: { other: ["RailRoad on road squares"] },
        },
        Recycling: {
          prereqs: ["Mass Production", "Democracy"],
          allows: { buildings: ["Recycling Center"] },
        },
        Refining: {
          prereqs: ["Chemistry", "The Corporation"],
          allows: {},
        },
        Religion: {
          prereqs: ["Philosophy", "Writing"],
          allows: { wonders: ["Michelangelo's Chapel"] },
        },
        "The Republic": {
          prereqs: ["Code of Laws", "Literacy"],
          allows: { other: ["The Republic"], buildings: ["Courthouse"] },
        },
        Robotics: {
          prereqs: ["Plastics", "Computers"],
          allows: {},
        },
        Rocketry: {
          prereqs: ["Advanced Flight", "Electronics"],
          allows: {},
        },
        "Space Flight": {
          prereqs: ["Computers", "Rocketry"],
          allows: { units: ["Mech. Inf."], wonders: ["Apollo Program"], other: ["SS Component", "SS Module", "SS Structural"] },
        },
        "Steam Engine": {
          prereqs: ["Physics", "Invention"],
          allows: { units: ["Ironclad"] },
        },
        Steel: {
          prereqs: ["Metallurgy", "Industrialization"],
          allows: { units: ["Riflemen"] },
        },
        Superconductor: {
          prereqs: ["Plastics", "Mass Production"],
          allows: { wonders: ["SDI Defense"] },
        },
        "Theory of Gravity": {
          prereqs: ["Astronomy", "University"],
          allows: { wonders: ["Darwin's Voyage"] },
        },
        Trade: {
          prereqs: ["Currency", "Code of Laws"],
          allows: { buildings: ["Marketplace"] },
        },
        University: {
          prereqs: ["Mathematics", "Philosophy"],
          allows: { buildings: ["University"], wonders: ["Isaac Newton's College"] },
        },
        "The Wheel": {
          prereqs: [],
          allows: { units: ["Chariot"], other: ["Road on land squares"] },
        },
        Writing: {
          prereqs: ["Alphabet"],
          allows: { buildings: ["Library"], units: ["Diplomat"], wonders: ["Great Library"] },
        },
      };

      // Build an alphabetised list of techs
      const allTechs = Object.keys(advances).sort((a, b) => a.localeCompare(b));

      const techSelect = document.getElementById("tech");
      const searchInput = document.getElementById("search");
      const chainEl = document.getElementById("chain");
      const summaryEl = document.getElementById("summary");
      const notesEl = document.getElementById("notes");

      // Helper function to categorize an item
      function categorizeItem(item) {
        // Search through all advances to find which category this item belongs to
        for (const [techName, techData] of Object.entries(advances)) {
          const allows = techData.allows || {};
          for (const [category, items] of Object.entries(allows)) {
            if (Array.isArray(items) && items.includes(item)) {
              return category;
            }
          }
        }
        return "other";
      }

      // Helper function to get allows for a technology
      function getTechnologyAllows(tech) {
        const techAllows = advances[tech]?.allows || {};
        const categorized = { units: [], buildings: [], wonders: [], other: [] };

        // Process each category in the allows data
        Object.entries(techAllows).forEach(([category, items]) => {
          if (Array.isArray(items)) {
            items.forEach((item) => {
              const itemCategory = categorizeItem(item);
              if (!categorized[itemCategory].includes(item)) {
                categorized[itemCategory].push(item);
              }
            });
          }
        });

        return categorized;
      }

      function populateOptions(list = allTechs) {
        techSelect.innerHTML = "";
        list.forEach((t) => {
          const opt = document.createElement("option");
          opt.value = t;
          opt.textContent = t;
          techSelect.appendChild(opt);
        });
        if (techSelect.options.length) techSelect.selectedIndex = 0;
      }

      function filterOptions() {
        const q = searchInput.value.trim().toLowerCase();
        const filtered = q ? allTechs.filter((t) => t.toLowerCase().includes(q)) : allTechs;
        populateOptions(filtered);
        render();
      }

      // Depth-first search to gather prerequisites; returns in dependency order (prereqs first)
      function prerequisiteChain(target) {
        const seen = new Set();
        const order = [];
        function dfs(tech) {
          if (seen.has(tech)) return; // prevent cycles
          seen.add(tech);
          const reqs = advances[tech]?.prereqs || [];
          reqs.forEach(dfs); // ensure requirements come first
          order.push(tech);
        }
        // Build graph back from target; we don't include the target when reporting "needed" list
        const reqs = advances[target]?.prereqs || [];
        reqs.forEach(dfs);
        return order; // this contains only prerequisites, correctly ordered, no duplicates
      }

      function render() {
        const tech = techSelect.value;
        if (!tech) return;
        const chain = prerequisiteChain(tech);

        // Summary chips
        summaryEl.innerHTML = "";
        const chip1 = document.createElement("div");
        chip1.className = "chip";
        chip1.textContent = `Target: ${tech}`;
        summaryEl.appendChild(chip1);
        const chip2 = document.createElement("div");
        chip2.className = "chip";
        chip2.textContent = `Prerequisites: ${chain.length}`;
        summaryEl.appendChild(chip2);

        // Add color legend
        const legend = document.createElement("div");
        legend.style.marginTop = "12px";
        legend.style.fontSize = "11px";
        legend.style.color = "var(--muted)";
        legend.innerHTML = `
          <div style="margin-bottom: 4px;"><strong>Allows:</strong></div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <span class="allows-chip allows-unit">Units</span>
            <span class="allows-chip allows-building">Buildings</span>
            <span class="allows-chip allows-wonder">Wonders</span>
            <span class="allows-chip allows-other">Other</span>
          </div>
        `;
        summaryEl.appendChild(legend);

        // Render the ordered list
        chainEl.innerHTML = "";
        if (!chain.length) {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${tech}</strong> has no prerequisites.`;
          chainEl.appendChild(li);
        } else {
          chain.forEach((t, idx) => {
            const li = document.createElement("li");
            const deps = "";

            // Add allows information with color coding
            const techAllows = getTechnologyAllows(t);
            let allowsHtml = "";
            let allowsChips = [];

            Object.entries(techAllows).forEach(([category, items]) => {
              if (items.length > 0) {
                // Create individual chips for each item
                items.forEach((item) => {
                  // Map category names to singular form for CSS classes
                  const cssClass = category === "units" ? "unit" : category === "buildings" ? "building" : category === "wonders" ? "wonder" : "other";
                  allowsChips.push(`<span class="allows-chip allows-${cssClass}">${item}</span>`);
                });
              }
            });

            if (allowsChips.length > 0) {
              allowsHtml = allowsChips.join("");
            }

            li.innerHTML = `<strong>${t}</strong>${deps}${allowsHtml}`;
            chainEl.appendChild(li);
          });
          const final = document.createElement("li");
          final.innerHTML = `<strong class="accent">→ ${tech}</strong>`;
          chainEl.appendChild(final);
        }

        notesEl.innerHTML = `Tip: click a prerequisite in the list to make it the new target.`;

        // Make list items navigable
        Array.from(chainEl.querySelectorAll("li")).forEach((li) => {
          const name = li.textContent
            .replace(/^\d+\.\s*/, "")
            .replace(/^→\s*/, "")
            .replace(/\s*\(.*$/, "")
            .trim();
          if (advances[name]) {
            li.style.cursor = "pointer";
            li.onclick = () => {
              const idx = allTechs.indexOf(name);
              if (idx >= 0) {
                // select the item in the dropdown if present
                for (let i = 0; i < techSelect.options.length; i++) {
                  if (techSelect.options[i].value === name) {
                    techSelect.selectedIndex = i;
                    break;
                  }
                }
                render();
              }
            };
          }
        });
      }

      // Initialise
      populateOptions();
      render();
    </script>
  </body>
</html>
